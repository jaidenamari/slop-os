# VDD Workflow — Verification-Driven Development Reference

This skill provides the methodology reference for The Crucible's VDD pipeline. Load this skill when you need to understand or execute the development workflow correctly.

## The VDD Loop

### Phase 1: Intake and Decomposition

```
/spec <description>  →  spec-analyst classifies work, writes spec.md
                         [HUMAN GATE: approve spec]
/plan                →  scout explores codebase, orchestrator decomposes into Chainlink issues
                         each issue tagged: routine | critical
                         dependencies set between issues
                         [HUMAN GATE: approve plan]
```

### Phase 2: The Forge (Build + Validate)

```
/build <issue-id>

1. State Check     — Read Chainlink issue requirements and dependencies
2. Triage          — Check issue label: routine or critical
3. Test Writer     — (critical only) Write failing tests for critical logic
4. Builder         — Implement code, run specific test file, surface Cowardice
5. Validator       — Run full suite, types, lint, spec compliance
   FAIL (iter < 3) — Feed validator report to builder, re-implement, re-validate
   FAIL (iter = 3) — ESCALATE TO HUMAN with full history
   PASS routine    — Git commit, chainlink close, next task
   PASS critical   — Generate ROAST_ME.md, proceed to Phase 3
```

### Phase 3: The Roast (Critical Tasks Only)

```
1. /build generates ROAST_ME.md with: The Intent, The Change, The Cowardice
2. Developer copies ROAST_ME.md contents
3. Developer opens NEW Sarcasmotron chat (fresh context, no carry-over)
4. Developer pastes ROAST_ME.md contents (no pleasantries)
5. Sarcasmotron critiques for intent and edge cases
6. Developer judges: legitimate flaw or hallucination?
7. Legitimate issues → feed back to builder → validator re-checks
8. Repeat until: ZERO-SLOP verdict or hallucination detected
```

### Phase 4: Commit

```
Code passes Forge validation AND the Roast (if critical)

git commit -m "task(<id>): <description>"
chainlink close <issue-id>
chainlink session action "Task <id> complete: <summary>"
```

## Triage Classification

| Path | When | Pipeline |
|------|------|----------|
| **Routine** | Bug fixes, CSS, config, simple CRUD, dependency updates, docs | builder → validator → commit |
| **Critical** | Business logic, auth, ranking, search, analytics, math, security | test-writer → builder → validator → Roast → commit |

Consult `critical-paths.md` to determine which files/areas are critical. When in doubt, ask the developer.

## Builder Contract

- Implement minimum code to satisfy the spec
- Run the specific test file for this task (not the full suite)
- Do NOT refactor unrelated code
- Do NOT modify existing tests
- Maximum 5 files per task — stop and report BLOCKED if exceeded
- Surface uncertainty in the Cowardice section — do not hide doubt

## Validator Contract

- MUST NOT modify files
- MUST run ALL checks: git diff, full test suite, type checker, linter
- Evaluate against task spec — every acceptance criterion gets pass/fail
- Be specific: file paths, line numbers, concrete descriptions
- Do NOT suggest fixes — report problems
- If iterating: verify prior issues were actually fixed, not just papered over

## ROAST_ME.md Format

Generated by the orchestrator after validator PASS on critical tasks:

```
## The Intent
[Acceptance criteria from spec.md — what this code is supposed to do]

## The Change
[Compact git diff focused on the functions that changed — not the whole repo]

## The Cowardice
[Things the builder was unsure about or flagged as risky]
- "Not sure if negative boost_factor should clamp to 0 or throw"
- "Assumed relevance is always defined, didn't add NaN guard"
```

## Breadcrumb Discipline

Every pipeline step MUST log via `chainlink session action`. At minimum:

1. **Triage decision** — `"Triage: routine|critical for issue #N — [reason]"`
2. **Builder outcome** — `"Builder COMPLETE|BLOCKED: [what and why]"`
3. **Validator verdict** — `"Validator PASS|FAIL iteration N: [summary]"`
4. **Task completion** — `"Task #N complete: [summary]"`

Store reasoning, not just actions:
- Bad: `"Updated weights"`
- Good: `"Changed boost_factor from 1.5 to 2.0. Low-boost items ranked above high-relevance items in edge cases."`

## Convergence Signals

See `references/convergence.md` for detailed guidance on detecting when loops should terminate.
